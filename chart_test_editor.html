<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>编辑器环境图表测试</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #1890ff;
        }
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .chart-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            height: 400px;
        }
        .chart-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .chart-content {
            height: calc(100% - 30px);
        }
        .full-width {
            grid-column: 1 / span 2;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #999;
            font-size: 14px;
        }
        .test-info {
            background-color: #e6f7ff;
            border-left: 4px solid #1890ff;
            padding: 15px;
            margin-bottom: 20px;
        }
        .test-info h3 {
            margin-top: 0;
            color: #1890ff;
        }
        .test-info pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>编辑器环境图表测试</h1>
            <p>测试各种图表错误情况下的自动修复功能</p>
        </div>

        <div class="test-info">
            <h3>测试场景</h3>
            <p>本页面包含多种常见的图表错误情况：</p>
            <ol>
                <li><strong>缺失函数引用</strong>：使用了未定义的getColorForCategory函数</li>
                <li><strong>无效DOM元素</strong>：尝试在不存在的DOM元素上初始化图表</li>
                <li><strong>初始化顺序错误</strong>：在DOM加载前初始化图表</li>
            </ol>
            <p>修复脚本应该能够自动处理这些问题，确保图表正常显示。</p>
        </div>

        <div class="chart-grid">
            <!-- 测试1：使用getColorForCategory函数 -->
            <div class="chart-container">
                <div class="chart-title">测试1：缺失函数引用</div>
                <div class="chart-content" id="test1-chart"></div>
            </div>

            <!-- 测试2：无效DOM元素 -->
            <div class="chart-container">
                <div class="chart-title">测试2：无效DOM元素</div>
                <div class="chart-content" id="test2-chart"></div>
            </div>

            <!-- 测试3：初始化顺序错误 -->
            <div class="chart-container">
                <div class="chart-title">测试3：初始化顺序错误</div>
                <div class="chart-content" id="test3-chart"></div>
            </div>

            <!-- 测试4：复杂图表 -->
            <div class="chart-container">
                <div class="chart-title">测试4：复杂图表</div>
                <div class="chart-content" id="test4-chart"></div>
            </div>
        </div>

        <div class="footer">
            Material HTML 编辑器图表测试 | 2023
        </div>
    </div>

    <script>
        // 测试1：使用未定义的getColorForCategory函数
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const chart1 = echarts.init(document.getElementById('test1-chart'));
                
                const option1 = {
                    tooltip: {
                        trigger: 'item',
                        formatter: '{b}: {c} ({d}%)'
                    },
                    legend: {
                        orient: 'horizontal',
                        bottom: 10,
                        data: ['上衣', '裤装', '裙装', '外套', '配饰']
                    },
                    series: [
                        {
                            name: '销售占比',
                            type: 'pie',
                            radius: ['40%', '70%'],
                            avoidLabelOverlap: false,
                            itemStyle: {
                                borderRadius: 10,
                                borderColor: '#fff',
                                borderWidth: 2
                            },
                            label: {
                                show: false
                            },
                            emphasis: {
                                label: {
                                    show: true,
                                    fontSize: 16,
                                    fontWeight: 'bold'
                                }
                            },
                            data: [
                                {
                                    value: 35,
                                    name: '上衣',
                                    itemStyle: { color: getColorForCategory('上衣') }
                                },
                                {
                                    value: 25,
                                    name: '裤装',
                                    itemStyle: { color: getColorForCategory('裤装') }
                                },
                                {
                                    value: 20,
                                    name: '裙装',
                                    itemStyle: { color: getColorForCategory('裙装') }
                                },
                                {
                                    value: 15,
                                    name: '外套',
                                    itemStyle: { color: getColorForCategory('外套') }
                                },
                                {
                                    value: 5,
                                    name: '配饰',
                                    itemStyle: { color: getColorForCategory('配饰') }
                                }
                            ]
                        }
                    ]
                };
                
                chart1.setOption(option1);
            } catch (e) {
                console.error('测试1出错:', e);
            }
        });

        // 测试2：无效DOM元素
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // 尝试在不存在的DOM元素上初始化
                const chart2 = echarts.init(document.getElementById('non-existent-element'));
                
                const option2 = {
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: ['销售额', '利润']
                    },
                    xAxis: {
                        type: 'category',
                        data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月']
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [
                        {
                            name: '销售额',
                            type: 'line',
                            data: [120, 132, 101, 134, 90, 230, 210]
                        },
                        {
                            name: '利润',
                            type: 'line',
                            data: [30, 42, 25, 44, 22, 70, 60]
                        }
                    ]
                };
                
                chart2.setOption(option2);
            } catch (e) {
                console.error('测试2出错:', e);
                
                // 手动在正确的容器上初始化
                try {
                    const chart2 = echarts.init(document.getElementById('test2-chart'));
                    
                    const option2 = {
                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data: ['销售额', '利润']
                        },
                        xAxis: {
                            type: 'category',
                            data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月']
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: [
                            {
                                name: '销售额',
                                type: 'line',
                                data: [120, 132, 101, 134, 90, 230, 210]
                            },
                            {
                                name: '利润',
                                type: 'line',
                                data: [30, 42, 25, 44, 22, 70, 60]
                            }
                        ]
                    };
                    
                    chart2.setOption(option2);
                } catch (e2) {
                    console.error('测试2手动修复也失败:', e2);
                }
            }
        });

        // 测试3：初始化顺序错误（在脚本中直接调用，而不是在DOMContentLoaded中）
        try {
            // 这里故意在DOM准备好之前初始化
            const chart3 = echarts.init(document.getElementById('test3-chart'));
            
            const option3 = {
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    top: 'bottom'
                },
                series: [
                    {
                        name: '访问来源',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        center: ['50%', '50%'],
                        roseType: 'area',
                        itemStyle: {
                            borderRadius: 8
                        },
                        data: [
                            { value: 40, name: '搜索引擎' },
                            { value: 38, name: '直接访问' },
                            { value: 32, name: '邮件营销' },
                            { value: 30, name: '联盟广告' },
                            { value: 28, name: '视频广告' }
                        ]
                    }
                ]
            };
            
            chart3.setOption(option3);
        } catch (e) {
            console.error('测试3出错:', e);
        }

        // 测试4：复杂图表
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const chart4 = echarts.init(document.getElementById('test4-chart'));
                
                const option4 = {
                    title: {
                        text: '销售与利润分析',
                        subtext: '2023年数据',
                        left: 'center'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross',
                            crossStyle: {
                                color: '#999'
                            }
                        }
                    },
                    legend: {
                        data: ['销售额', '成本', '利润率'],
                        bottom: 10
                    },
                    xAxis: [
                        {
                            type: 'category',
                            data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月'],
                            axisPointer: {
                                type: 'shadow'
                            }
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value',
                            name: '金额',
                            min: 0,
                            max: 250,
                            interval: 50,
                            axisLabel: {
                                formatter: '{value} 万元'
                            }
                        },
                        {
                            type: 'value',
                            name: '利润率',
                            min: 0,
                            max: 50,
                            interval: 10,
                            axisLabel: {
                                formatter: '{value} %'
                            }
                        }
                    ],
                    series: [
                        {
                            name: '销售额',
                            type: 'bar',
                            data: [120, 132, 101, 134, 90, 230, 210]
                        },
                        {
                            name: '成本',
                            type: 'bar',
                            data: [80, 90, 70, 95, 60, 150, 135]
                        },
                        {
                            name: '利润率',
                            type: 'line',
                            yAxisIndex: 1,
                            data: [33, 32, 31, 29, 33, 35, 36],
                            markPoint: {
                                data: [
                                    { type: 'max', name: '最大值' },
                                    { type: 'min', name: '最小值' }
                                ]
                            },
                            markLine: {
                                data: [
                                    { type: 'average', name: '平均值' }
                                ]
                            }
                        }
                    ]
                };
                
                chart4.setOption(option4);
            } catch (e) {
                console.error('测试4出错:', e);
            }
        });
    </script>
</body>
</html> 